<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Shrine::Storage::S3</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      function popupCode(url) {
        window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
      }
      
      function toggleCode(id) {
        var code = document.getElementById(id)
      
        code.style.display = code.style.display != 'block' ? 'block' : 'none'
        return true
      }
      
      // Make codeblocks hidden by default
      document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Shrine::Storage::S3
        </h1>
        <ol class='paths'>
          <li>
            <a href="https://github.com/janko-m/shrine/blob/8a361a7c2e5d3edcc591a3b5e1bf75a2558fd94f/lib/shrine/storage/s3.rb">lib/shrine/storage/s3.rb</a> <img src="/images/github.png" width=13 height=12 style="position:absolute; margin-left:5px;">
          </li>
        </ol>
        <div class='parent'>
          Superclass:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The <a href="S3.html">S3</a> storage handles uploads to Amazon <a
            href="S3.html">S3</a> service, using the <a
            href="https://github.com/aws/aws-sdk-ruby">aws-sdk</a> gem:</p>
            
            <pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&quot;aws-sdk&quot;</span>, <span class="ruby-string">&quot;~&gt; 2.1&quot;</span></pre>
            
            <p>It is initialized with the following 4 required options:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(&#x000A;  <span class="ruby-identifier">access_key_id</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;xyz&quot;</span>,&#x000A;  <span class="ruby-identifier">secret_access_key</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;abc&quot;</span>,&#x000A;  <span class="ruby-identifier">region</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;eu-west-1&quot;</span>,&#x000A;  <span class="ruby-identifier">bucket</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;my-app&quot;</span>,&#x000A;)</pre>
            
            <h2 id="class-Shrine::Storage::S3-label-Prefix">Prefix<span><a href="#class-Shrine::Storage::S3-label-Prefix">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>The <code>:prefix</code> option can be specified for uploading all files
            inside a specific <a href="S3.html">S3</a> prefix (folder), which is useful
            when using <a href="S3.html">S3</a> for both cache and store:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">prefix</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;cache&quot;</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;<span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">prefix</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;store&quot;</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)</pre>
            
            <h2 id="class-Shrine::Storage::S3-label-Upload+options">Upload options<span><a href="#class-Shrine::Storage::S3-label-Upload+options">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>Sometimes you&#39;ll want to add additional upload options to all <a
            href="S3.html">S3</a> uploads. You can do that by passing the
            <code>:upload</code> option:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">upload_options</span><span class="ruby-operator">:</span> {<span class="ruby-identifier">acl</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;public-read&quot;</span>}, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)</pre>
            
            <p>These options will be passed to aws-sdk&#39;s methods for <a
            href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#put-instance_method">uploading</a>,
            <a
            href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#copy_from-instance_method">copying</a>
            and <a
            href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#presigned_post-instance_method">presigning</a>.</p>
            
            <p>You can also generate upload options per upload with the
            <code>upload_options</code> plugin:</p>
            
            <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">upload_options</span>, <span class="ruby-identifier">store</span><span class="ruby-operator">:</span> <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>) <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>[:<span class="ruby-identifier">version</span>] <span class="ruby-operator">==</span> :<span class="ruby-identifier">thumb</span>&#x000A;      {<span class="ruby-identifier">acl</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;public-read&quot;</span>}&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      {<span class="ruby-identifier">acl</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;private&quot;</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p>Note that, unlike the <code>:upload_options</code> storage option, the
            <code>upload_options</code> plugin won&#39;t forward the given options for
            generating presigns, since presigns are generated using the storage
            directly.</p>
            
            <h2 id="class-Shrine::Storage::S3-label-URL+options">URL options<span><a href="#class-Shrine::Storage::S3-label-URL+options">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>This storage supports various URL options that will be forwarded from
            uploaded file.</p>
            
            <pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)   <span class="ruby-comment"># public URL without signed parameters</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">download</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-comment"># forced download URL</span></pre>
            
            <p>All other options are forwarded to the <a
            href="https://github.com/aws/aws-sdk-ruby">aws-sdk</a> gem:</p>
            
            <pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">expires_in</span><span class="ruby-operator">:</span> <span class="ruby-value">15</span>)&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">virtual_host</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)</pre>
            
            <h2 id="class-Shrine::Storage::S3-label-CDN">CDN<span><a href="#class-Shrine::Storage::S3-label-CDN">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>If you&#39;re using a CDN with <a href="S3.html">S3</a> like Amazon
            CloudFront, you can specify the <code>:host</code> option to
            <code>#url</code>:</p>
            
            <pre class="ruby"><span class="ruby-identifier">s3</span> = <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&quot;image.jpg&quot;</span>, <span class="ruby-identifier">host</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;http://abc123.cloudfront.net&quot;</span>)&#x000A;<span class="ruby-comment">#=&gt; &quot;http://abc123.cloudfront.net/image.jpg&quot;</span></pre>
            
            <h2 id="class-Shrine::Storage::S3-label-Accelerate+endpoint">Accelerate endpoint<span><a href="#class-Shrine::Storage::S3-label-Accelerate+endpoint">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>To use Amazon S3&#39;s <a
            href="http://docs.aws.amazon.com/AmazonS3/latest/dev/transfer-acceleration.html">Transfer
            Acceleration</a> feature, you can change the <code>:endpoint</code> of the
            underlying client to the accelerate endpoint, and this will be applied both
            to regular and presigned uploads, as well as download URLs.</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">endpoint</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;https://s3-accelerate.amazonaws.com&quot;</span>)</pre>
            
            <h2 id="class-Shrine::Storage::S3-label-Presigns">Presigns<span><a href="#class-Shrine::Storage::S3-label-Presigns">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>This storage can generate presigns for direct uploads to Amazon <a
            href="S3.html">S3</a>, and it accepts additional options which are passed
            to <a href="https://github.com/aws/aws-sdk-ruby">aws-sdk</a>. There are
            three places in which you can specify presign options:</p>
            <ul><li>
            <p>in <code>:upload_options</code> option on this storage</p>
            </li><li>
            <p>in <code>direct_upload</code> plugin through <code>:presign_options</code></p>
            </li><li>
            <p>in <code>Storage::S3#presign</code> by forwarding options</p>
            </li></ul>
            
            <h2 id="class-Shrine::Storage::S3-label-Large+files">Large files<span><a href="#class-Shrine::Storage::S3-label-Large+files">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>The <a href="https://github.com/aws/aws-sdk-ruby">aws-sdk</a> gem has the
            ability to automatically use multipart upload/copy for larger files, where
            the file is split into multiple chunks which are uploaded/copied in
            parallel.</p>
            
            <p>By default any files that are larger than 15MB will use this multipart
            upload/copy, but you change this threshold:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">multipart_threshold</span><span class="ruby-operator">:</span> <span class="ruby-value">30</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span>) <span class="ruby-comment"># 30MB</span></pre>
            
            <h2 id="class-Shrine::Storage::S3-label-Clearing+cache">Clearing cache<span><a href="#class-Shrine::Storage::S3-label-Clearing+cache">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>If you&#39;re using <a href="S3.html">S3</a> as a cache, you will probably
            want to periodically delete old files which aren&#39;t used anymore. <a
            href="S3.html">S3</a> has a built-in way to do this, read <a
            href="http://docs.aws.amazon.com/AmazonS3/latest/UG/lifecycle-configuration-bucket-no-versioning.html">this
            article</a> for instructions.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a href="#attribute-i-bucket">bucket</a></li>
              <li><a href="#method-i-clear-21">clear!</a></li>
              <li><a href="#method-i-delete">delete</a></li>
              <li><a href="#method-i-download">download</a></li>
              <li><a href="#method-i-exists-3F">exists?</a></li>
              <li><a href="#attribute-i-host">host</a></li>
              <li><a href="#method-i-method_missing">method_missing</a></li>
              <li><a href="#method-i-multi_delete">multi_delete</a></li>
              <li><a href="#method-i-open">open</a></li>
              <li><a href="#attribute-i-prefix">prefix</a></li>
              <li><a href="#method-i-presign">presign</a></li>
              <li><a href="#attribute-i-s3">s3</a></li>
              <li><a href="#method-i-upload">upload</a></li>
              <li><a href="#attribute-i-upload_options">upload_options</a></li>
              <li><a href="#method-i-url">url</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-bucket'>bucket</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-host'>host</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-prefix'>prefix</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-s3'>s3</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-upload_options'>upload_options</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(bucket:, prefix: nil, host: nil, upload_options: {}, multipart_threshold: 15*1024*1024, **s3_options)</span>
                </div>
                <div class='description'>
                  
                  <p>Initializes a storage for uploading to <a href="S3.html">S3</a>.</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:access_key_id<br />:secret_access_key<br />:region<br />:bucket</td><td>
                  <p>Credentials required by the <code>aws-sdk</code> gem.</p>
                  </td></tr><tr><td class='label'>:prefix</td><td>
                  <p>“Folder” name inside the bucket to store files into.</p>
                  </td></tr><tr><td class='label'>:upload_options</td><td>
                  <p>Additional options that will be used for uploading files, they will  be
                  passed to <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#put-instance_method">Aws::S3::Object#put</a>,
                  <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#copy_from-instance_method">Aws::S3::Object#copy_from</a>
                  and <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#presigned_post-instance_method">Aws::S3::Bucket#presigned_post</a>.</p>
                  </td></tr><tr><td class='label'>:multipart_threshold</td><td>
                  <p>The file size over which the storage will use parallelized  multipart
                  copy/upload. Default is <code>15*1024*1024</code> (15MB).</p>
                  </td></tr></tbody></table>
                  
                  <p>All other options are forwarded to <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Client.html#initialize-instance_method">Aws::S3::Client#initialize</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 151</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">bucket</span>,, <span class="ruby-identifier">prefix</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">host</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">upload_options</span><span class="ruby-operator">:</span> {}, <span class="ruby-identifier">multipart_threshold</span><span class="ruby-operator">:</span> <span class="ruby-value">15</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;The :host option to Shrine::Storage::S3#initialize is deprecated and will be removed in Shrine 3. Pass :host to S3#url instead, you can also use default_url_options plugin.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">host</span>&#x000A;&#x000A;  <span class="ruby-ivar">@prefix</span> = <span class="ruby-identifier">prefix</span>&#x000A;  <span class="ruby-ivar">@s3</span> = <span class="ruby-constant">Aws</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span><span class="ruby-operator">::</span><span class="ruby-constant">Resource</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;  <span class="ruby-ivar">@bucket</span> = <span class="ruby-ivar">@s3</span>.<span class="ruby-identifier">bucket</span>(<span class="ruby-identifier">bucket</span>)&#x000A;  <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>&#x000A;  <span class="ruby-ivar">@upload_options</span> = <span class="ruby-identifier">upload_options</span>&#x000A;  <span class="ruby-ivar">@multipart_threshold</span> = <span class="ruby-identifier">multipart_threshold</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-clear-21'>
                <a name='method-i-clear-21'></a>
                <div class='synopsis'>
                  <span class='name'>clear!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Deletes all files from the storage.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-clear-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-clear-21-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 261</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear!</span>&#x000A;  <span class="ruby-identifier">objects</span> = <span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">object_versions</span>(<span class="ruby-identifier">prefix</span><span class="ruby-operator">:</span> <span class="ruby-identifier">prefix</span>)&#x000A;  <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:batch_delete!</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">batch_delete!</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">delete</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-delete'>
                <a name='method-i-delete'></a>
                <div class='synopsis'>
                  <span class='name'>delete</span>
                  <span class='arguments'>(id)</span>
                </div>
                <div class='description'>
                  
                  <p>Deletes the file from <a href="S3.html">S3</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-delete-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-delete-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 206</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">delete</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-download'>
                <a name='method-i-download'></a>
                <div class='synopsis'>
                  <span class='name'>download</span>
                  <span class='arguments'>(id)</span>
                </div>
                <div class='description'>
                  
                  <p>Downloads the file from <a href="S3.html">S3</a>, and returns a
                  <code>Tempfile</code>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-download-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-download-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 187</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">download</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">tempfile</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>([<span class="ruby-string">&quot;s3&quot;</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">id</span>)], <span class="ruby-identifier">binmode</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)&#x000A;  (<span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>)).<span class="ruby-identifier">get</span>(<span class="ruby-identifier">response_target</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">path</span>)&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">singleton_class</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-identifier">attr_accessor</span> <span class="ruby-value">:content_type</span> }&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">content_type</span>&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">tap</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:open</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-exists-3F'>
                <a name='method-i-exists-3F'></a>
                <div class='synopsis'>
                  <span class='name'>exists?</span>
                  <span class='arguments'>(id)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns true file exists on <a href="S3.html">S3</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-exists-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-exists-3F-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 201</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">exists?</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-method_missing'>
                <a name='method-i-method_missing'></a>
                <div class='synopsis'>
                  <span class='name'>method_missing</span>
                  <span class='arguments'>(name, *args)</span>
                </div>
                <div class='description'>
                  
                  <p>Catches the deprecated <code>#stream</code> method.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-method_missing-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-method_missing-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 279</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value">:stream</span>&#x000A;    <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Shrine::Storage::S3#stream is deprecated over calling #each_chunk on S3#open.&quot;</span>&#x000A;    <span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;    <span class="ruby-identifier">object</span>.<span class="ruby-identifier">get</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">chunk</span>, <span class="ruby-identifier">object</span>.<span class="ruby-identifier">content_length</span> }&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-keyword">super</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-multi_delete'>
                <a name='method-i-multi_delete'></a>
                <div class='synopsis'>
                  <span class='name'>multi_delete</span>
                  <span class='arguments'>(ids)</span>
                </div>
                <div class='description'>
                  
                  <p>This is called when multiple files are being deleted at once. Issues a
                  single MULTI DELETE command for each 1000 objects (S3 delete limit).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-multi_delete-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-multi_delete-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 212</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">multi_delete</span>(<span class="ruby-identifier">ids</span>)&#x000A;  <span class="ruby-identifier">objects</span> = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">take</span>(<span class="ruby-value">1000</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> {<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">key</span>} }&#x000A;  <span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">delete_objects</span>(<span class="ruby-identifier">delete</span><span class="ruby-operator">:</span> {<span class="ruby-identifier">objects</span><span class="ruby-operator">:</span> <span class="ruby-identifier">objects</span>})&#x000A;&#x000A;  <span class="ruby-identifier">rest</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">ids</span>[<span class="ruby-value">1000</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])&#x000A;  <span class="ruby-identifier">multi_delete</span>(<span class="ruby-identifier">rest</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rest</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-open'>
                <a name='method-i-open'></a>
                <div class='synopsis'>
                  <span class='name'>open</span>
                  <span class='arguments'>(id)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns a <code>Down::ChunkedIO</code> object representing the <a
                  href="S3.html">S3</a> object.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-open-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-open-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 196</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">open</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-constant">Down</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>(<span class="ruby-identifier">id</span>), <span class="ruby-identifier">ssl_ca_cert</span><span class="ruby-operator">:</span> <span class="ruby-constant">Aws</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:ssl_ca_bundle</span>])&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-presign'>
                <a name='method-i-presign'></a>
                <div class='synopsis'>
                  <span class='name'>presign</span>
                  <span class='arguments'>(id, **options)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns a signature for direct uploads. Internally it calls <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Bucket.html#presigned_post-instance_method">Aws::S3::Bucket#presigned_post</a>,
                  and forwards any additional options to it.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-presign-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-presign-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 271</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">presign</span>(<span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span> = <span class="ruby-identifier">upload_options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">presigned_post</span>(<span class="ruby-identifier">options</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-upload'>
                <a name='method-i-upload'></a>
                <div class='synopsis'>
                  <span class='name'>upload</span>
                  <span class='arguments'>(io, id, shrine_metadata: {}, **upload_options)</span>
                </div>
                <div class='description'>
                  
                  <p>If the file is an <a href="../UploadedFile.html">UploadedFile</a> from <a
                  href="S3.html">S3</a>, issues a COPY command, otherwise uploads the file.</p>
                  
                  <p>It assigns the correct “Content-Type” taken from the MIME type, because by
                  default <a href="S3.html">S3</a> sets everything to
                  “application/octet-stream”.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-upload-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-upload-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 167</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">shrine_metadata</span><span class="ruby-operator">:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">upload_options</span>)&#x000A;  <span class="ruby-identifier">content_type</span>, <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">shrine_metadata</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-string">&quot;mime_type&quot;</span>, <span class="ruby-string">&quot;filename&quot;</span>)&#x000A;&#x000A;  <span class="ruby-identifier">options</span> = {}&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_type</span>] = <span class="ruby-identifier">content_type</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_type</span>&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-node">&quot;inline; filename=\&quot;#{filename}\&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>&#x000A;&#x000A;  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-ivar">@upload_options</span>)&#x000A;  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">upload_options</span>)&#x000A;&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">copyable?</span>(<span class="ruby-identifier">io</span>)&#x000A;    <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">put</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-url'>
                <a name='method-i-url'></a>
                <div class='synopsis'>
                  <span class='name'>url</span>
                  <span class='arguments'>(id, download: nil, public: nil, host: self.host, **options)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns the presigned URL to the file.</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:public</td><td>
                  <p>Creates an unsigned version of the URL (the permissions on the <a
                  href="S3.html">S3</a>  bucket need to be modified to allow public URLs).</p>
                  </td></tr><tr><td class='label'>:host</td><td>
                  <p>This option replaces the host part of the returned URL, and is  typically
                  useful for setting CDN hosts (e.g. 
                  <code>http://abc123.cloudfront.net</code>)</p>
                  </td></tr><tr><td class='label'>:download</td><td>
                  <p>If set to <code>true</code>, creates a “forced download” link, which means
                  that  the browser will never display the file and always ask the user to 
                  download it.</p>
                  </td></tr></tbody></table>
                  
                  <p>All other options are forwarded to <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#presigned_url-instance_method">Aws::S3::Object#presigned_url</a>
                  or <a
                  href="http://docs.aws.amazon.com/sdkforruby/api/Aws/S3/Object.html#public_url-instance_method">Aws::S3::Object#public_url</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-url-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-url-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 241</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">url</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">download</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">host</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">host</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;attachment&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">download</span>&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">public</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">public_url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">presigned_url</span>(<span class="ruby-value">:get</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">host</span>&#x000A;    <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>)&#x000A;    <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">match</span>(<span class="ruby-node">/^\/#{bucket.name}/</span>).<span class="ruby-identifier">post_match</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">name</span>)&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">request_uri</span>).<span class="ruby-identifier">to_s</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">url</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
    </div>
  </body>
</html>
