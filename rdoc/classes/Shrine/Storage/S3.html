<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Shrine::Storage::S3</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>class</span>
Shrine::Storage::S3
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/shrine/storage/s3_rb.html">lib/shrine/storage/s3.rb</a>
</li>
</ol>
<div class='parent'>
Superclass:
<strong>Object</strong>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>The <a href="S3.html">S3</a> storage handles uploads to Amazon <a
href="S3.html">S3</a> service, using the <a
href="https://github.com/aws/aws-sdk-ruby/tree/master/gems/aws-sdk-s3">aws-sdk-s3</a>
gem:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&quot;aws-sdk-s3&quot;</span>, <span class="ruby-string">&quot;~&gt; 1.2&quot;</span></pre>

<p>It can be initialized by providing the bucket name and credentials:</p>

<pre class="ruby"><span class="ruby-identifier">s3</span> = <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(&#x000A;  <span class="ruby-value">access_key_id:</span> <span class="ruby-string">&quot;abc&quot;</span>,&#x000A;  <span class="ruby-value">secret_access_key:</span> <span class="ruby-string">&quot;xyz&quot;</span>,&#x000A;  <span class="ruby-value">region:</span> <span class="ruby-string">&quot;eu-west-1&quot;</span>,&#x000A;  <span class="ruby-value">bucket:</span> <span class="ruby-string">&quot;my-app&quot;</span>,&#x000A;)</pre>

<p>The core features of this storage requires the following AWS permissions:
<code>s3:ListBucket</code>, <code>s3:PutObject</code>,
<code>s3:GetObject</code>, and <code>s3:DeleteObject</code>. If you have
additional upload options configured such as setting object ACLs, then
additional permissions may be required.</p>

<p>The storage exposes the underlying <a href="../../Aws.html">Aws</a>
objects:</p>

<pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">client</span> <span class="ruby-comment">#=&gt; #&lt;Aws::S3::Client&gt;</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">access_key_id</span> <span class="ruby-comment">#=&gt; &quot;abc&quot;</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">secret_access_key</span> <span class="ruby-comment">#=&gt; &quot;xyz&quot;</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">region</span> <span class="ruby-comment">#=&gt; &quot;eu-west-1&quot;</span>&#x000A;&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">bucket</span> <span class="ruby-comment">#=&gt; #&lt;Aws::S3::Bucket&gt;</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment">#=&gt; &quot;my-app&quot;</span>&#x000A;&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">object</span>(<span class="ruby-string">&quot;key&quot;</span>) <span class="ruby-comment">#=&gt; #&lt;Aws::S3::Object&gt;</span></pre>

<h2 id="class-Shrine::Storage::S3-label-Prefix">Prefix<span><a href="#class-Shrine::Storage::S3-label-Prefix">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The <code>:prefix</code> option can be specified for uploading all files
inside a specific <a href="S3.html">S3</a> prefix (folder), which is useful
when using <a href="S3.html">S3</a> for both cache and store:</p>

<pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;cache&quot;</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)</pre>

<h2 id="class-Shrine::Storage::S3-label-Upload+options">Upload options<span><a href="#class-Shrine::Storage::S3-label-Upload+options">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sometimes you&#39;ll want to add additional upload options to all <a
href="S3.html">S3</a> uploads. You can do that by passing the
<code>:upload</code> option:</p>

<pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">upload_options:</span> { <span class="ruby-value">acl:</span> <span class="ruby-string">&quot;private&quot;</span> }, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)</pre>

<p>These options will be passed to aws-sdk-s3&#39;s methods for <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#put-instance_method">uploading</a>,
<a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#copy_from-instance_method">copying</a>
and <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#presigned_post-instance_method">presigning</a>.</p>

<p>You can also generate upload options per upload with the
<code>upload_options</code> plugin</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:upload_options</span>, <span class="ruby-value">store:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>) <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>[<span class="ruby-value">:version</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:thumb</span>&#x000A;      {<span class="ruby-value">acl:</span> <span class="ruby-string">&quot;public-read&quot;</span>}&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      {<span class="ruby-value">acl:</span> <span class="ruby-string">&quot;private&quot;</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>or when using the uploader directly</p>

<pre class="ruby"><span class="ruby-identifier">uploader</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value">upload_options:</span> { <span class="ruby-value">acl:</span> <span class="ruby-string">&quot;private&quot;</span> })</pre>

<p>Note that, unlike the <code>:upload_options</code> storage option, upload
options given on the uploader level won&#39;t be forwarded for generating
presigns, since presigns are generated using the storage directly.</p>

<h2 id="class-Shrine::Storage::S3-label-URL+options">URL options<span><a href="#class-Shrine::Storage::S3-label-URL+options">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>This storage supports various URL options that will be forwarded from
uploaded file.</p>

<pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">public:</span> <span class="ruby-keyword">true</span>)   <span class="ruby-comment"># public URL without signed parameters</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">download:</span> <span class="ruby-keyword">true</span>) <span class="ruby-comment"># forced download URL</span></pre>

<p>All other options are forwarded to the aws-sdk-s3 gem:</p>

<pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">expires_in:</span> <span class="ruby-value">15</span>)&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">virtual_host:</span> <span class="ruby-keyword">true</span>)</pre>

<h2 id="class-Shrine::Storage::S3-label-CDN">CDN<span><a href="#class-Shrine::Storage::S3-label-CDN">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If you&#39;re using a CDN with <a href="S3.html">S3</a> like Amazon
CloudFront, you can specify the <code>:host</code> option to
<code>#url</code>:</p>

<pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&quot;image.jpg&quot;</span>, <span class="ruby-value">host:</span> <span class="ruby-string">&quot;http://abc123.cloudfront.net&quot;</span>)&#x000A;<span class="ruby-comment">#=&gt; &quot;http://abc123.cloudfront.net/image.jpg&quot;</span></pre>

<p>You have the <code>:host</code> option passed automatically for every URL
with the <code>default_url_options</code> plugin.</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:default_url_options</span>, <span class="ruby-value">store:</span> { <span class="ruby-value">host:</span> <span class="ruby-string">&quot;http://abc123.cloudfront.net&quot;</span> }</pre>

<h2 id="class-Shrine::Storage::S3-label-Accelerate+endpoint">Accelerate endpoint<span><a href="#class-Shrine::Storage::S3-label-Accelerate+endpoint">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>To use Amazon S3&#39;s <a
href="http://docs.aws.amazon.com/AmazonS3/latest/dev/transfer-acceleration.html">Transfer
Acceleration</a> feature, you can change the <code>:endpoint</code> of the
underlying client to the accelerate endpoint, and this will be applied both
to regular and presigned uploads, as well as download URLs.</p>

<pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">endpoint:</span> <span class="ruby-string">&quot;https://s3-accelerate.amazonaws.com&quot;</span>)</pre>

<h2 id="class-Shrine::Storage::S3-label-Presigns">Presigns<span><a href="#class-Shrine::Storage::S3-label-Presigns">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>This storage can generate presigns for direct uploads to Amazon <a
href="S3.html">S3</a>, and it accepts additional options which are passed
to aws-sdk-s3. There are three places in which you can specify presign
options:</p>
<ul><li>
<p>in <code>:upload_options</code> option on this storage</p>
</li><li>
<p>in <code>presign_endpoint</code> plugin through
<code>:presign_options</code></p>
</li><li>
<p>in <code>Storage::S3#presign</code> by forwarding options</p>
</li></ul>

<h2 id="class-Shrine::Storage::S3-label-Large+files">Large files<span><a href="#class-Shrine::Storage::S3-label-Large+files">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The aws-sdk-s3 gem has the ability to automatically use multipart
upload/copy for larger files, splitting the file into multiple chunks and
uploading/copying them in parallel.</p>

<p>By default any files that are uploaded will use the multipart upload if
they&#39;re larger than 15MB, and any files that are copied will use the
multipart copy if they&#39;re larger than 150MB, but you can change the
thresholds via <code>:multipart_threshold</code>.</p>

<pre class="ruby"><span class="ruby-identifier">thresholds</span> = { <span class="ruby-value">upload:</span> <span class="ruby-value">30</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span>, <span class="ruby-value">copy:</span> <span class="ruby-value">200</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span> }&#x000A;<span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">multipart_threshold:</span> <span class="ruby-identifier">thresholds</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)</pre>

<p>If you want to change how many threads aws-sdk-s3 will use for multipart
upload/copy, you can use the <code>upload_options</code> plugin to specify
<code>:thread_count</code>.</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:upload_options</span>, <span class="ruby-value">store:</span> <span class="ruby-operator">-&gt;</span> (<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>) <span class="ruby-keyword">do</span>&#x000A;  { <span class="ruby-value">thread_count:</span> <span class="ruby-value">5</span> }&#x000A;<span class="ruby-keyword">end</span></pre>

<h2 id="class-Shrine::Storage::S3-label-Clearing+cache">Clearing cache<span><a href="#class-Shrine::Storage::S3-label-Clearing+cache">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If you&#39;re using <a href="S3.html">S3</a> as a cache, you will probably
want to periodically delete old files which aren&#39;t used anymore. <a
href="S3.html">S3</a> has a built-in way to do this, read <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#put-instance_method">this
article</a> for instructions.</p>

<p>Alternatively you can periodically call the <code>#clear!</code> method:</p>

<pre class="ruby"><span class="ruby-comment"># deletes all objects that were uploaded more than 7 days ago</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">clear!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">last_modified</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-value">7</span><span class="ruby-operator">*</span><span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span> }</pre>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#attribute-i-bucket">bucket</a></li>
<li><a href="#method-i-clear-21">clear!</a></li>
<li><a href="#attribute-i-client">client</a></li>
<li><a href="#method-i-delete">delete</a></li>
<li><a href="#method-i-download">download</a></li>
<li><a href="#method-i-exists-3F">exists?</a></li>
<li><a href="#attribute-i-host">host</a></li>
<li><a href="#method-i-method_missing">method_missing</a></li>
<li><a href="#method-i-object">object</a></li>
<li><a href="#method-i-open">open</a></li>
<li><a href="#attribute-i-prefix">prefix</a></li>
<li><a href="#method-i-presign">presign</a></li>
<li><a href="#method-i-s3">s3</a></li>
<li><a href="#method-i-upload">upload</a></li>
<li><a href="#attribute-i-upload_options">upload_options</a></li>
<li><a href="#method-i-url">url</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="S3/MultipartUploader.html">Shrine::Storage::S3::MultipartUploader</a></li>
</ol>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>MIN_PART_SIZE</td>
<td>=</td>
<td class='context-item-value'>5 * 1024 * 1024</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-bucket'>bucket</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-client'>client</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-host'>host</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-prefix'>prefix</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-upload_options'>upload_options</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span>
<span class='arguments'>(bucket:, prefix: nil, host: nil, upload_options: {}, multipart_threshold: {}, **s3_options)</span>

</div>
<div class='description'>

<p>Initializes a storage for uploading to <a href="S3.html">S3</a>. All
options are forwarded to <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Client.html#initialize-instance_method">Aws::S3::Client#initialize</a>,
except the following:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:bucket</td><td>
<p>(Required). Name of the <a href="S3.html">S3</a> bucket.</p>
</td></tr><tr><td class='label'>:prefix</td><td>
<p>“Directory” inside the bucket to store files into.</p>
</td></tr><tr><td class='label'>:upload_options</td><td>
<p>Additional options that will be used for uploading files, they will  be
passed to <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#put-instance_method">Aws::S3::Object#put</a>,
<a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#copy_from-instance_method">Aws::S3::Object#copy_from</a>
and <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#presigned_post-instance_method">Aws::S3::Bucket#presigned_post</a>.</p>
</td></tr><tr><td class='label'>:multipart_threshold</td><td>
<p>If the input file is larger than the specified size, a parallelized 
multipart will be used for the upload/copy. Defaults to  <code>{upload:&#x000A;15*1024*1024, copy: 100*1024*1024}</code> (15MB for upload  requests, 100MB
for copy requests).</p>
</td></tr></tbody></table>

<p>In addition to specifying the <code>:bucket</code>, you&#39;ll also need to
provide AWS credentials. The most common way is to provide them directly
via <code>:access_key_id</code>, <code>:secret_access_key</code>, and
<code>:region</code> options. But you can also use any other way of
authentication specified in the <a
href="https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-config.html">AWS
SDK documentation</a>.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 215</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-value">bucket:</span>, <span class="ruby-value">prefix:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">host:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">upload_options:</span> {}, <span class="ruby-value">multipart_threshold:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;  <span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">deprecation</span>(<span class="ruby-string">&quot;The :host option to Shrine::Storage::S3#initialize is deprecated and will be removed in Shrine 3. Pass :host to S3#url instead, you can also use default_url_options plugin.&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">host</span>&#x000A;  <span class="ruby-identifier">resource</span> = <span class="ruby-constant">Aws</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span><span class="ruby-operator">::</span><span class="ruby-constant">Resource</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">s3_options</span>)&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">multipart_threshold</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)&#x000A;    <span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">deprecation</span>(<span class="ruby-string">&quot;Accepting the :multipart_threshold S3 option as an integer is deprecated, use a hash with :upload and :copy keys instead, e.g. {upload: 15*1024*1024, copy: 150*1024*1024}&quot;</span>)&#x000A;    <span class="ruby-identifier">multipart_threshold</span> = { <span class="ruby-value">upload:</span> <span class="ruby-identifier">multipart_threshold</span> }&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">multipart_threshold</span> = { <span class="ruby-value">upload:</span> <span class="ruby-value">15</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span>, <span class="ruby-value">copy:</span> <span class="ruby-value">100</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">multipart_threshold</span>)&#x000A;&#x000A;  <span class="ruby-ivar">@bucket</span> = <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">bucket</span>(<span class="ruby-identifier">bucket</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">fail</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;the :bucket option was nil&quot;</span>)&#x000A;  <span class="ruby-ivar">@client</span> = <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">client</span>&#x000A;  <span class="ruby-ivar">@prefix</span> = <span class="ruby-identifier">prefix</span>&#x000A;  <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>&#x000A;  <span class="ruby-ivar">@upload_options</span> = <span class="ruby-identifier">upload_options</span>&#x000A;  <span class="ruby-ivar">@multipart_threshold</span> = <span class="ruby-identifier">multipart_threshold</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-clear-21'>
<a name='method-i-clear-21'></a>
<div class='synopsis'>
<span class='name'>clear!</span>
<span class='arguments'>(&block)</span>

</div>
<div class='description'>

<p>If block is given, deletes all objects from the storage for which the block
evaluates to true. Otherwise deletes all objects from the storage.</p>

<pre class="ruby"><span class="ruby-identifier">s3</span>.<span class="ruby-identifier">clear!</span>&#x000A;<span class="ruby-comment"># or</span>&#x000A;<span class="ruby-identifier">s3</span>.<span class="ruby-identifier">clear!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">last_modified</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-value">7</span><span class="ruby-operator">*</span><span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span> }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-clear-21-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-clear-21-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 382</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">objects_to_delete</span> = <span class="ruby-constant">Enumerator</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">yielder</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-value">prefix:</span> <span class="ruby-identifier">prefix</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">yielder</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">object</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">object</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">delete_objects</span>(<span class="ruby-identifier">objects_to_delete</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-delete'>
<a name='method-i-delete'></a>
<div class='synopsis'>
<span class='name'>delete</span>
<span class='arguments'>(id)</span>

</div>
<div class='description'>

<p>Deletes the file from the storage.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-delete-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-delete-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 372</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">delete</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-download'>
<a name='method-i-download'></a>
<div class='synopsis'>
<span class='name'>download</span>
<span class='arguments'>(id, **options)</span>

</div>
<div class='description'>

<p>Downloads the file from <a href="S3.html">S3</a>, and returns a
<code>Tempfile</code>. Any additional options are forwarded to <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#get-instance_method">Aws::S3::Object#get</a>.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-download-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-download-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 270</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download</span>(<span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">tempfile</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>([<span class="ruby-string">&quot;shrine-s3&quot;</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">id</span>)], <span class="ruby-value">binmode:</span> <span class="ruby-keyword">true</span>)&#x000A;  (<span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>)).<span class="ruby-identifier">get</span>(<span class="ruby-value">response_target:</span> <span class="ruby-identifier">tempfile</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">singleton_class</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-identifier">attr_accessor</span> <span class="ruby-value">:content_type</span> }&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">content_type</span>&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">tap</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:open</span>)&#x000A;<span class="ruby-keyword">rescue</span>&#x000A;  <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">close!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tempfile</span>&#x000A;  <span class="ruby-identifier">raise</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-exists-3F'>
<a name='method-i-exists-3F'></a>
<div class='synopsis'>
<span class='name'>exists?</span>
<span class='arguments'>(id)</span>

</div>
<div class='description'>

<p>Returns true file exists on <a href="S3.html">S3</a>.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-exists-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-exists-3F-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 293</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exists?</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">exists?</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-method_missing'>
<a name='method-i-method_missing'></a>
<div class='synopsis'>
<span class='name'>method_missing</span>
<span class='arguments'>(name, *args)</span>

</div>
<div class='description'>

<p>Catches the deprecated <code>#stream</code> method.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-method_missing-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-method_missing-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 398</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">method_missing</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value">:stream</span>&#x000A;    <span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">deprecation</span>(<span class="ruby-string">&quot;Shrine::Storage::S3#stream is deprecated over calling #each_chunk on S3#open.&quot;</span>)&#x000A;    <span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;    <span class="ruby-identifier">object</span>.<span class="ruby-identifier">get</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">chunk</span>, <span class="ruby-identifier">object</span>.<span class="ruby-identifier">content_length</span> }&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-keyword">super</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-object'>
<a name='method-i-object'></a>
<div class='synopsis'>
<span class='name'>object</span>
<span class='arguments'>(id)</span>

</div>
<div class='description'>

<p>Returns an <code>Aws::S3::Object</code> for the given id.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-object-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-object-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 393</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">object</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">object</span>([<span class="ruby-operator">*</span><span class="ruby-identifier">prefix</span>, <span class="ruby-identifier">id</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;/&quot;</span>))&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-open'>
<a name='method-i-open'></a>
<div class='synopsis'>
<span class='name'>open</span>
<span class='arguments'>(id, **options)</span>

</div>
<div class='description'>

<p>Returns a <code>Down::ChunkedIO</code> object representing the <a
href="S3.html">S3</a> object. Any additional options are forwarded to <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#get-instance_method">Aws::S3::Object#get</a>.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-open-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-open-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 285</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">open</span>(<span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>)&#x000A;  <span class="ruby-identifier">io</span> = <span class="ruby-constant">Down</span><span class="ruby-operator">::</span><span class="ruby-constant">ChunkedIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">chunks:</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">enum_for</span>(<span class="ruby-value">:get</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>), <span class="ruby-value">data:</span> { <span class="ruby-value">object:</span> <span class="ruby-identifier">object</span> })&#x000A;  <span class="ruby-identifier">io</span>.<span class="ruby-identifier">size</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">content_length</span>&#x000A;  <span class="ruby-identifier">io</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-presign'>
<a name='method-i-presign'></a>
<div class='synopsis'>
<span class='name'>presign</span>
<span class='arguments'>(id, method: :post, **options)</span>

</div>
<div class='description'>

<p>Returns URL, params and headers for direct uploads. By default it generates
data for a POST request, calling <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#presigned_post-instance_method">Aws::S3::Object#presigned_post</a>.
You can also specify <code>method: :put</code> to generate data for a PUT
request, using <a
href="https://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#presigned_url-instance_method">Aws::S3::Object#presigned_url</a>.
Any additional options are forwarded to the underlying AWS SDK method.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-presign-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-presign-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 346</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">presign</span>(<span class="ruby-identifier">id</span>, <span class="ruby-value">method:</span> <span class="ruby-value">:post</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span> = <span class="ruby-ivar">@upload_options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value">:post</span>&#x000A;    <span class="ruby-identifier">presigned_post</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">presigned_post</span>(<span class="ruby-identifier">options</span>)&#x000A;&#x000A;    <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:method</span>, <span class="ruby-value">:url</span>, <span class="ruby-value">:fields</span>).<span class="ruby-identifier">new</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">presigned_post</span>.<span class="ruby-identifier">url</span>, <span class="ruby-identifier">presigned_post</span>.<span class="ruby-identifier">fields</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">presigned_url</span>(<span class="ruby-identifier">method</span>, <span class="ruby-identifier">options</span>)&#x000A;&#x000A;    <span class="ruby-comment"># When any of these options are specified, the corresponding request</span>&#x000A;    <span class="ruby-comment"># headers must be included in the upload request.</span>&#x000A;    <span class="ruby-identifier">headers</span> = {}&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-Length&quot;</span>]      = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_length</span>]      <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_length</span>]&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-Type&quot;</span>]        = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_type</span>]        <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_type</span>]&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-Disposition&quot;</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-Encoding&quot;</span>]    = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_encoding</span>]    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_encoding</span>]&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-Language&quot;</span>]    = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_language</span>]    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_language</span>]&#x000A;    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Content-MD5&quot;</span>]         = <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_md5</span>]         <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_md5</span>]&#x000A;&#x000A;    { <span class="ruby-value">method:</span> <span class="ruby-identifier">method</span>, <span class="ruby-value">url:</span> <span class="ruby-identifier">url</span>, <span class="ruby-value">headers:</span> <span class="ruby-identifier">headers</span> }&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-s3'>
<a name='method-i-s3'></a>
<div class='synopsis'>
<span class='name'>s3</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Returns an <code>Aws::S3::Resource</code> object.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-s3-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-s3-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 234</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">s3</span>&#x000A;  <span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">deprecation</span>(<span class="ruby-string">&quot;Shrine::Storage::S3#s3 that returns an Aws::S3::Resource is deprecated, use Shrine::Storage::S3#client which returns an Aws::S3::Client object.&quot;</span>)&#x000A;  <span class="ruby-constant">Aws</span><span class="ruby-operator">::</span><span class="ruby-constant">S3</span><span class="ruby-operator">::</span><span class="ruby-constant">Resource</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">client:</span> <span class="ruby-ivar">@client</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-upload'>
<a name='method-i-upload'></a>
<div class='synopsis'>
<span class='name'>upload</span>
<span class='arguments'>(io, id, shrine_metadata: {}, **upload_options)</span>

</div>
<div class='description'>

<p>If the file is an <a href="../UploadedFile.html">UploadedFile</a> from <a
href="S3.html">S3</a>, issues a COPY command, otherwise uploads the file.
For files larger than <code>:multipart_threshold</code> a multipart
upload/copy will be used for better performance and more resilient uploads.</p>

<p>It assigns the correct “Content-Type” taken from the MIME type, because by
default <a href="S3.html">S3</a> sets everything to
“application/octet-stream”.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-upload-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-upload-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 246</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-value">shrine_metadata:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">upload_options</span>)&#x000A;  <span class="ruby-identifier">content_type</span>, <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">shrine_metadata</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-string">&quot;mime_type&quot;</span>, <span class="ruby-string">&quot;filename&quot;</span>)&#x000A;&#x000A;  <span class="ruby-identifier">options</span> = {}&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_type</span>] = <span class="ruby-identifier">content_type</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_type</span>&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-node">&quot;inline; filename=\&quot;#{filename}\&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>&#x000A;&#x000A;  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-ivar">@upload_options</span>)&#x000A;  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">upload_options</span>)&#x000A;&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">copyable?</span>(<span class="ruby-identifier">io</span>)&#x000A;    <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">bytes_uploaded</span> = <span class="ruby-identifier">put</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;    <span class="ruby-identifier">shrine_metadata</span>[<span class="ruby-string">&quot;size&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">bytes_uploaded</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-url'>
<a name='method-i-url'></a>
<div class='synopsis'>
<span class='name'>url</span>
<span class='arguments'>(id, download: nil, public: nil, host: self.host, **options)</span>

</div>
<div class='description'>

<p>Returns the presigned URL to the file.</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:public</td><td>
<p>Controls whether the URL is signed (<code>false</code>) or unsigned
(<code>true</code>).  Note that for unsigned URLs the <a
href="S3.html">S3</a> bucket need to be modified to allow  public URLs.
Defaults to <code>false</code>.</p>
</td></tr><tr><td class='label'>:host</td><td>
<p>This option replaces the host part of the returned URL, and is  typically
useful for setting CDN hosts (e.g. 
<code>http://abc123.cloudfront.net</code>)</p>
</td></tr><tr><td class='label'>:download</td><td>
<p>If set to <code>true</code>, creates a “forced download” link, which means
that  the browser will never display the file and always ask the user to 
download it.</p>
</td></tr></tbody></table>

<p>All other options are forwarded to <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#presigned_url-instance_method">Aws::S3::Object#presigned_url</a>
or <a
href="http://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#public_url-instance_method">Aws::S3::Object#public_url</a>.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-url-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-url-source'><span class="ruby-comment"># File lib/shrine/storage/s3.rb, line 319</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">url</span>(<span class="ruby-identifier">id</span>, <span class="ruby-value">download:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">public:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">host:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">host</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;attachment&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">download</span>&#x000A;  <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>] = <span class="ruby-identifier">encode_content_disposition</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:response_content_disposition</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">public</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">public_url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">object</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">presigned_url</span>(<span class="ruby-value">:get</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">host</span>&#x000A;    <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>)&#x000A;    <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^\/#{bucket.name}/</span>).<span class="ruby-identifier">post_match</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">bucket</span>.<span class="ruby-identifier">name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">force_path_style</span>&#x000A;    <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">request_uri</span>).<span class="ruby-identifier">to_s</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">url</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
