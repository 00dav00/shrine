<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Shrine::Plugins::Base::InstanceMethods</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Shrine::Plugins::Base::InstanceMethods
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../../files/lib/shrine_rb.html">lib/shrine.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'></div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-default_url">default_url</a></li>
              <li><a target="docwin" href="#method-i-delete">delete</a></li>
              <li><a target="docwin" href="#method-i-extract_metadata">extract_metadata</a></li>
              <li><a target="docwin" href="#method-i-generate_location">generate_location</a></li>
              <li><a target="docwin" href="#method-i-opts">opts</a></li>
              <li><a target="docwin" href="#method-i-process">process</a></li>
              <li><a target="docwin" href="#attribute-i-storage">storage</a></li>
              <li><a target="docwin" href="#attribute-i-storage_key">storage_key</a></li>
              <li><a target="docwin" href="#method-i-store">store</a></li>
              <li><a target="docwin" href="#method-i-upload">upload</a></li>
              <li><a target="docwin" href="#method-i-uploaded-3F">uploaded?</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-storage'>storage</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The storage object identified by <a
                      href="InstanceMethods.html#attribute-i-storage_key">storage_key</a>.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-storage_key'>storage_key</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The symbol that identifies the storage.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(storage_key)</span>
                </div>
                <div class='description'>
                  
                  <p>Accepts a storage symbol registered in <code>Shrine.storages</code>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/shrine.rb, line 197</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">storage_key</span>)&#x000A;  <span class="ruby-ivar">@storage</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_storage</span>(<span class="ruby-identifier">storage_key</span>)&#x000A;  <span class="ruby-ivar">@storage_key</span> = <span class="ruby-identifier">storage_key</span>.<span class="ruby-identifier">to_sym</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-default_url'>
                <a name='method-i-default_url'></a>
                <div class='synopsis'>
                  <span class='name'>default_url</span>
                  <span class='arguments'>(context)</span>
                </div>
                <div class='description'>
                  
                  <p>User-defined default URL for when a file is missing (called by
                  <code>Attacher#url</code>).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-default_url-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-default_url-source'><span class="ruby-comment"># File lib/shrine.rb, line 280</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">default_url</span>(<span class="ruby-identifier">context</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-delete'>
                <a name='method-i-delete'></a>
                <div class='synopsis'>
                  <span class='name'>delete</span>
                  <span class='arguments'>(uploaded_file, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>Deletes the given uploaded file.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-delete-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-delete-source'><span class="ruby-comment"># File lib/shrine.rb, line 253</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">uploaded_file</span>, <span class="ruby-identifier">context</span> = {})&#x000A;  <span class="ruby-identifier">_delete</span>(<span class="ruby-identifier">uploaded_file</span>, <span class="ruby-identifier">context</span>)&#x000A;  <span class="ruby-identifier">uploaded_file</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-extract_metadata'>
                <a name='method-i-extract_metadata'></a>
                <div class='synopsis'>
                  <span class='name'>extract_metadata</span>
                  <span class='arguments'>(io, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>Extracts filename, size and MIME type from the file, which is later
                  accessible through <code>UploadedFile#metadata</code>. When the uploaded
                  file is later promoted, this metadata is simply copied over.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-extract_metadata-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-extract_metadata-source'><span class="ruby-comment"># File lib/shrine.rb, line 270</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_metadata</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span> = {})&#x000A;  {&#x000A;    <span class="ruby-string">&quot;filename&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extract_filename</span>(<span class="ruby-identifier">io</span>),&#x000A;    <span class="ruby-string">&quot;size&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extract_size</span>(<span class="ruby-identifier">io</span>),&#x000A;    <span class="ruby-string">&quot;mime_type&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extract_mime_type</span>(<span class="ruby-identifier">io</span>),&#x000A;  }&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-generate_location'>
                <a name='method-i-generate_location'></a>
                <div class='synopsis'>
                  <span class='name'>generate_location</span>
                  <span class='arguments'>(io, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>Generates a unique location for the uploaded file, and preserves an
                  optional extension.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-generate_location-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-generate_location-source'><span class="ruby-comment"># File lib/shrine.rb, line 260</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_location</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span> = {})&#x000A;  <span class="ruby-identifier">extension</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">extract_filename</span>(<span class="ruby-identifier">io</span>).<span class="ruby-identifier">to_s</span>)&#x000A;  <span class="ruby-identifier">basename</span>  = <span class="ruby-identifier">generate_uid</span>(<span class="ruby-identifier">io</span>)&#x000A;&#x000A;  <span class="ruby-identifier">basename</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">extension</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-opts'>
                <a name='method-i-opts'></a>
                <div class='synopsis'>
                  <span class='name'>opts</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>The class-level options hash. This should probably not be modified at the
                  instance level.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-opts-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-opts-source'><span class="ruby-comment"># File lib/shrine.rb, line 204</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">opts</span>&#x000A;  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">opts</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-process'>
                <a name='method-i-process'></a>
                <div class='synopsis'>
                  <span class='name'>process</span>
                  <span class='arguments'>(io, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>User is expected to perform processing inside of this method, and return
                  the processed files. Returning nil signals that no proccessing has been
                  done and that the original file should be used. When used with <a
                  href="../../Attachment.html">Shrine::Attachment</a>, the context variable
                  will hold the record, name of the attachment and the phase.</p>
                  
                  <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ImageUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">process</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>)&#x000A;    <span class="ruby-keyword">case</span> <span class="ruby-identifier">context</span>[:<span class="ruby-identifier">phase</span>]&#x000A;    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">cache</span>&#x000A;      <span class="ruby-comment"># do processing</span>&#x000A;    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">store</span>&#x000A;      <span class="ruby-comment"># do processing</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-process-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-process-source'><span class="ruby-comment"># File lib/shrine.rb, line 233</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">process</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span> = {})&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-store'>
                <a name='method-i-store'></a>
                <div class='synopsis'>
                  <span class='name'>store</span>
                  <span class='arguments'>(io, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>Uploads the file and returns an instance of <a
                  href="../../UploadedFile.html">Shrine::UploadedFile</a>. By default the
                  location of the file is automatically generated by <a
                  href="InstanceMethods.html#method-i-generate_location">generate_location</a>,
                  but you can pass in <code>:location</code> to upload to a specific
                  location.</p>
                  
                  <pre class="ruby"><span class="ruby-identifier">uploader</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">location</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;custom/location.jpg&quot;</span>)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-store-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-store-source'><span class="ruby-comment"># File lib/shrine.rb, line 242</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">store</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span> = {})&#x000A;  <span class="ruby-identifier">_store</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-upload'>
                <a name='method-i-upload'></a>
                <div class='synopsis'>
                  <span class='name'>upload</span>
                  <span class='arguments'>(io, context = {})</span>
                </div>
                <div class='description'>
                  
                  <p>The main method for uploading files. Takes in an IO object and an optional
                  context (used internally by <a
                  href="../../Attacher.html">Shrine::Attacher</a>). It calls user-defined <a
                  href="InstanceMethods.html#method-i-process">process</a>, and aferwards it
                  calls <a href="InstanceMethods.html#method-i-store">store</a>. The
                  <code>io</code> is closed after upload.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-upload-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-upload-source'><span class="ruby-comment"># File lib/shrine.rb, line 212</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span> = {})&#x000A;  <span class="ruby-identifier">io</span> = <span class="ruby-identifier">processed</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">io</span>&#x000A;  <span class="ruby-identifier">store</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">context</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-uploaded-3F'>
                <a name='method-i-uploaded-3F'></a>
                <div class='synopsis'>
                  <span class='name'>uploaded?</span>
                  <span class='arguments'>(uploaded_file)</span>
                </div>
                <div class='description'>
                  
                  <p>Checks if the storage identified with this instance uploaded the given
                  file.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-uploaded-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-uploaded-3F-source'><span class="ruby-comment"># File lib/shrine.rb, line 248</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">uploaded?</span>(<span class="ruby-identifier">uploaded_file</span>)&#x000A;  <span class="ruby-identifier">uploaded_file</span>.<span class="ruby-identifier">storage_key</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">storage_key</span>.<span class="ruby-identifier">to_s</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
