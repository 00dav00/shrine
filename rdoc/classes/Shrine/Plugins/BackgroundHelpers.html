<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Shrine::Plugins::BackgroundHelpers</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Shrine::Plugins::BackgroundHelpers
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/shrine/plugins/background_helpers_rb.html">lib/shrine/plugins/background_helpers.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The background_helpers plugin enables you to intercept phases of uploading
            and put them into background jobs. This doesn&#39;t require any additional
            columns.</p>
            
            <pre class="ruby"><span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">background_helpers</span></pre>
            
            <h2 id="module-Shrine::Plugins::BackgroundHelpers-label-Promoting">Promoting<span><a href="#module-Shrine::Plugins::BackgroundHelpers-label-Promoting">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>If you&#39;re doing processing, or your <code>:store</code> is something
            other than <a href="../Storage/FileSystem.html">Storage::FileSystem</a>,
            it&#39;s recommended to put promoting (moving to store) into a background
            job. This plugin allows you to do that by calling
            <code>Shrine::Attacher.promote</code>:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">promote</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-constant">UploadJob</span>.<span class="ruby-identifier">perform_async</span>(<span class="ruby-identifier">data</span>) }</pre>
            
            <p>When you call <code>Shrine::Attacher.promote</code> with a block, it will
            save the block and call it on every promotion. Then in your background job
            you can again call <code>Shrine::Attacher.promote</code> with the data, and
            internally it will resolve all necessary objects, do the promoting and
            update the record.</p>
            
            <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">UploadJob</span>&#x000A;  <span class="ruby-identifier">include</span> <span class="ruby-constant">Sidekiq</span><span class="ruby-operator">::</span><span class="ruby-constant">Worker</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">perform</span>(<span class="ruby-identifier">data</span>)&#x000A;    <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">promote</span>(<span class="ruby-identifier">data</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p><a href="../../Shrine.html">Shrine</a> automatically handles all
            concurrency issues, such as canceling promoting if the attachment has
            changed in the meanwhile.</p>
            
            <h2 id="module-Shrine::Plugins::BackgroundHelpers-label-Deleting">Deleting<span><a href="#module-Shrine::Plugins::BackgroundHelpers-label-Deleting">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>If your <code>:store</code> is something other than <a
            href="../Storage/FileSystem.html">Storage::FileSystem</a>, it&#39;s
            recommended to put deleting files into a background job. This plugin allows
            you to do that by calling <code>Shrine::Attacher.delete</code>:</p>
            
            <pre class="ruby"><span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">delete</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-constant">DeleteJob</span>.<span class="ruby-identifier">perform_async</span>(<span class="ruby-identifier">data</span>) }</pre>
            
            <p>When you call <code>Shrine::Attacher.delete</code> with a block, it will
            save the block and call it on every delete. Then in your background job you
            can again call <code>Shrine::Attacher.delete</code> with the data, and
            internally it will resolve all necessary objects, and delete the file.</p>
            
            <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">DeleteJob</span>&#x000A;  <span class="ruby-identifier">include</span> <span class="ruby-constant">Sidekiq</span><span class="ruby-operator">::</span><span class="ruby-constant">Worker</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">perform</span>(<span class="ruby-identifier">data</span>)&#x000A;    <span class="ruby-constant">Shrine</span><span class="ruby-operator">::</span><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">data</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <h2 id="module-Shrine::Plugins::BackgroundHelpers-label-Conclusion">Conclusion<span><a href="#module-Shrine::Plugins::BackgroundHelpers-label-Conclusion">&para;</a> <a href="#top">&uarr;</a></span></h2>
            
            <p>The examples above used Sidekiq, but obviously you can just as well use any
            other backgrounding library. Also, if you want you can use backgrounding
            just for certain uploaders:</p>
            
            <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ImageUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">promote</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-constant">UploadJob</span>.<span class="ruby-identifier">perform_async</span>(<span class="ruby-identifier">data</span>) }&#x000A;  <span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">delete</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-constant">DeleteJob</span>.<span class="ruby-identifier">perform_async</span>(<span class="ruby-identifier">data</span>) }&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p>If you would like to speed up your uploads and deletes, you can use the
            parallelize plugin, either as a replacement or an addition to
            background_helpers.</p>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="BackgroundHelpers/AttacherClassMethods.html">Shrine::Plugins::BackgroundHelpers::AttacherClassMethods</a></li>
              <li><a target="docwin" href="BackgroundHelpers/AttacherMethods.html">Shrine::Plugins::BackgroundHelpers::AttacherMethods</a></li>
            </ol>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
